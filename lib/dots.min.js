/*
 * dots.js 0.0.1
 * Copyright (C) 2015 Ricardo Conde
 * Licence: GNU General Public Licence
 */var Dots=function(a,t,e){var i=e||{};this.tolerance=i.tolerance||.8,this.amount=i.amount||.7,this.canvasW=i.width||!1,this.canvasH=i.height||!1,this.rgba=i.rgba||!1,this.container=t,this.particles=[],this.mouse={x:0,y:0},this.myCanvas=document.createElement("canvas"),this.myCanvasContext=this.myCanvas.getContext("2d"),this.create(a)};Dots.prototype={create:function(a){var t=new Image,e=this;document.addEventListener("mousemove",function(a){e.mouse.x=a.clientX||a.pageX,e.mouse.y=a.clientY||a.pageY}),this.animate(),t.onload=function(){var a,i,s,n,h,r,o,m,g=[];for(e.myCanvas.width=e.canvasW?e.canvasW:t.width,e.myCanvas.height=e.canvasH?e.canvasH:t.height,s=e.myCanvas.width/2-t.width/2,n=e.myCanvas.height/2-t.height/2,h=0,e.container.appendChild(e.myCanvas),e.myCanvasContext.drawImage(t,0,0),e.imageData=e.myCanvasContext.getImageData(0,0,t.width,t.height),e.myCanvasContext.clearRect(0,0,e.myCanvas.width,e.myCanvas.height),o=0;o<e.imageData.height;o++)for(m=0;m<e.imageData.width;m++)a=4*o*e.imageData.width+4*m,g=[e.imageData.data[a],e.imageData.data[a+1],e.imageData.data[a+2],e.imageData.data[a+3]],i=(g[0]+g[1]+g[2])/3,r=255*e.tolerance,r>i&&Math.random()<e.amount&&(e.particles[h]=e.dot(m+s,o+n,g),h++);e.draw()},t.src=a},update:function(){mouseX=this.mouse.x-this.container.getBoundingClientRect().left,mouseY=this.mouse.y-this.container.getBoundingClientRect().top;var a,t,e,i,s,n,h,r=160,o=0,m=r*r,g=[],c=[],v=this.particles.length;for(a=0;v>a;a++)t=this.particles[a],o=Math.sqrt(Math.pow(t.sx-t.x,2)+Math.pow(t.sy-t.y,2)),e=mouseX-t.sx,i=mouseY-t.sy,s=e*e+i*i,m>s?(e=mouseX-t.x,i=mouseY-t.y,n=1-s/m,h=Math.atan2(i,e),t.vx+=Math.cos(h)*n,t.vy+=Math.sin(h)*n):(t.vx+=.01*(t.sx-t.x),t.vy+=.01*(t.sy-t.y)),t.x+=4*t.vx,t.y+=4*t.vy,t.vx*=.95,t.vy*=.95,this.rgba=this.rgba||[t.rgba[0],t.rgba[1],t.rgba[2],t.rgba[3]],c[0]=Math.round((this.rgba[0]-t.rgba[0])*o/100),c[1]=Math.round((this.rgba[1]-t.rgba[1])*o/100),c[2]=Math.round((this.rgba[2]-t.rgba[2])*o/100),c[3]=Math.round((this.rgba[3]-t.rgba[3])*o/100),g[0]=t.rgba[0]+c[0],g[1]=t.rgba[1]+c[1],g[2]=t.rgba[2]+c[2],g[3]=t.rgba[3]+c[3],t.a=g[0]+","+g[1]+","+g[2]+","+g[3];this.draw()},draw:function(){var a;for(this.myCanvasContext.clearRect(0,0,this.myCanvas.width,this.myCanvas.height),a=0;a<this.particles.length;a++)this.myCanvasContext.beginPath(),this.myCanvasContext.fillStyle="rgba("+this.particles[a].a+")",this.myCanvasContext.fillRect(this.particles[a].x,this.particles[a].y,1,1),this.myCanvasContext.fill()},dot:function(a,t,e){var i={};return i.x=a||0,i.y=t||0,i.sx=a,i.sy=t,i.a=0,i.fx=0,i.fy=0,i.vx=0,i.vy=0,i.rgba=e,i},animate:function(){var a=this;this.update(),window.requestAnimationFrame(function(){a.animate()})}};